<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lawyer Reader</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f9f9f9; color: #333; }
    header { background: #2c3e50; color: #fff; padding: 10px; text-align: center; }
    nav { display: flex; justify-content: center; background: #34495e; }
    nav button { flex: 1; padding: 10px; background: #34495e; border: none; color: white; cursor: pointer; }
    nav button.active { background: #1abc9c; }
    #content { padding: 15px; }
    .card { background: #fff; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .dark-mode { background: #181818; color: #eee; }
    .dark-mode .card { background: #222; color: #eee; }
    .top-right { position: absolute; top: 10px; right: 10px; display: flex; gap: 10px; }
    .top-right button { background: #1abc9c; border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
    footer { background: #2c3e50; color: white; padding: 10px; text-align: center; font-size: 14px; }
  </style>
</head>
<body>

  <!-- ‚úÖ API Test Box will appear here -->
  <script>
  async function testAPI() {
    const apiUrl = "https://legalfeed.vercel.app/api/feeds";
    try {
      const res = await fetch(apiUrl);
      if (!res.ok) throw new Error("API not reachable: " + res.status);
      const data = await res.json();
      console.log("‚úÖ API Connected. Example feed:", data[0] || data);
      const testBox = document.createElement("div");
      testBox.style.background = "#222";
      testBox.style.color = "#0f0";
      testBox.style.padding = "10px";
      testBox.innerText = "API Connected ‚úî Example Title: " + (data[0]?.title || "No data");
      document.body.prepend(testBox);
    } catch (err) {
      console.error("‚ùå API Test Failed:", err);
      const testBox = document.createElement("div");
      testBox.style.background = "#222";
      testBox.style.color = "red";
      testBox.style.padding = "10px";
      testBox.innerText = "API Connection Failed ‚ùå " + err.message;
      document.body.prepend(testBox);
    }
  }
  testAPI();
  </script>

  <header>
    <h1>Lawyer Reader</h1>
    <div class="top-right">
      <button onclick="toggleDarkMode()">üåô</button>
      <button onclick="showCacheSize()">üíæ</button>
    </div>
  </header>

  <nav>
    <button onclick="showTab('livelaw')" class="active">LiveLaw</button>
    <button onclick="showTab('barbench')">Bar & Bench</button>
    <button onclick="showTab('ipleaders')">iPleaders</button>
    <button onclick="showTab('supremetoday')">SupremeToday</button>
    <button onclick="showTab('sconline')">SCC Online</button>
    <button onclick="showTab('indiankanoon')">Indian Kanoon</button>
    <button onclick="showTab('casemine')">Casemine</button>
    <button onclick="showTab('favorites')">Favorites</button>
  </nav>

  <div id="content"></div>

  <footer>
    Lawyer Reader ¬© 2025 | Last Updated: <span id="lastUpdated">Loading...</span>
  </footer>

  <script>
    const feeds = {
      livelaw: "https://www.livelaw.in/rssfeed",
      barbench: "https://www.barandbench.com/feed",
      ipleaders: "https://blog.ipleaders.in/feed/",
      supremetoday: "https://www.supremetoday.ai/rss",
      sconline: "https://www.scconline.com/feed/",
      indiankanoon: "https://legalfeed.vercel.app/api/feeds?site=indiankanoon",
      casemine: "https://legalfeed.vercel.app/api/feeds?site=casemine"
    };

    async function loadFeed(site) {
      const content = document.getElementById("content");
      content.innerHTML = "<p>Loading...</p>";
      try {
        const res = await fetch(feeds[site]);
        const data = await res.json();
        content.innerHTML = "";
        data.forEach(item => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `<h3>${item.title}</h3>
            <p>${item.contentSnippet || ""}</p>
            <a href="${item.link}" target="_blank">Read More</a>
            <button onclick="saveFavorite('${site}','${item.title}','${item.link}')">‚≠ê Favorite</button>`;
          content.appendChild(card);
        });
        document.getElementById("lastUpdated").innerText = new Date().toLocaleString();
      } catch (err) {
        content.innerHTML = "<p style='color:red'>Failed to load feed ‚ùå</p>";
        console.error(err);
      }
    }

    function showTab(site) {
      document.querySelectorAll("nav button").forEach(btn => btn.classList.remove("active"));
      event.target.classList.add("active");
      if (site === "favorites") {
        loadFavorites();
      } else {
        loadFeed(site);
      }
    }

    function saveFavorite(site, title, link) {
      const favs = JSON.parse(localStorage.getItem("favorites")) || [];
      favs.push({ site, title, link });
      localStorage.setItem("favorites", JSON.stringify(favs));
      alert("Added to favorites!");
    }

    function loadFavorites() {
      const favs = JSON.parse(localStorage.getItem("favorites")) || [];
      const content = document.getElementById("content");
      content.innerHTML = "<h2>Favorites</h2>";
      favs.forEach(f => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<h3>${f.title}</h3><a href="${f.link}" target="_blank">Read More</a>`;
        content.appendChild(card);
      });
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    function showCacheSize() {
      let _lsTotal = 0, _xLen, _x;
      for (_x in localStorage) {
        if (!localStorage.hasOwnProperty(_x)) continue;
        _xLen = ((localStorage[_x].length + _x.length) * 2);
        _lsTotal += _xLen;
      }
      alert("Cache size: " + (_lsTotal / 1024).toFixed(2) + " KB");
    }

    loadFeed("livelaw");
  </script>

</body>
</html>
